(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{146:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return o})),n.d(t,"default",(function(){return l}));var a=n(2),i=n(9),r=(n(0),n(161)),s={title:"PHP"},c={id:"php/php",title:"PHP",description:"## Gestion des pluriels",source:"@site/docs/php/php.md",permalink:"/best-practices/docs/php/php",editUrl:"https://github.com/mapado/best-practices/edit/master/docs/php/php.md",sidebar:"php",previous:{title:"Bonnes pratiques PHP",permalink:"/best-practices/docs/php"},next:{title:"Symfony",permalink:"/best-practices/docs/php/symfony"}},o=[{value:"Gestion des pluriels",id:"gestion-des-pluriels",children:[]},{value:"Assertions",id:"assertions",children:[]},{value:"If / Match / Switch",id:"if--match--switch",children:[]},{value:"Utilisation de <code>compact</code>",id:"utilisation-de-compact",children:[]}],p={rightToc:o};function l(e){var t=e.components,n=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"gestion-des-pluriels"},"Gestion des pluriels"),Object(r.b)("p",null,"Le nom des variables, quand elles sont au pluriels DOIVENT se terminer par ",Object(r.b)("inlineCode",{parentName:"p"},"List")," et NE DOIVENT PAS se terminer par ",Object(r.b)("inlineCode",{parentName:"p"},"s"),"."),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"Pourquoi ?")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Cela permet d'avoir une vrai segmentation visuelle afin de comprendre tr\xe8s rapidement que l'on est sur une liste en pas sur un objet simple."),Object(r.b)("p",{parentName:"div"},'Cela permet aussi d\'\xe9viter les probl\xe8mes de complexit\xe9s grammaticales en anglais (les mots terminant en "y" sont transform\xe9s en "ies" au pluriels : "cherry" / "cherries", les mots en "-f" prennent un "v", ex "wife" / "wives", etc.).'))),Object(r.b)("h2",{id:"assertions"},"Assertions"),Object(r.b)("p",null,"En PHP, on a plusieurs fa\xe7ons de faire des assertions. Pour rappel une assertions en PHP ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.php.net/assert"}),"est d\xe9finie de la mani\xe8re suivante")," :"),Object(r.b)("div",{className:"admonition admonition-info alert alert--info"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"Assertion")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Les assertions doivent \xeatre utilis\xe9es uniquement comme fonctionnalit\xe9 de d\xe9bogage. Un cas d'utilisation pour les assertions est de servir de v\xe9rifications de coh\xe9rence pour des pr\xe9conditions qui devraient toujours \xeatre true, et si elles ne sont pas respect\xe9es, cela indique des erreurs de programmation."))),Object(r.b)("p",null,"Autrement dit, si l'on envoit une erreur, c'est que c'est du code qui NE DOIT JAMAIS \xe9chouer."),Object(r.b)("p",null,"Une fa\xe7on de faire \xe7a est d'utiliser un ",Object(r.b)("inlineCode",{parentName:"p"},"if")," avec une exception :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"if (!is_int($id)) {\n    throw new \\LogicException('$id must be an int. This should not happen.');\n}\n")),Object(r.b)("p",null,"C'est tr\xe8s fonctionnel, mais c'est un peu verbeux, et on ne sait jamais trop quelle exception lancer (",Object(r.b)("inlineCode",{parentName:"p"},"InvalidArgumentException"),", ",Object(r.b)("inlineCode",{parentName:"p"},"RuntimeException"),", ",Object(r.b)("inlineCode",{parentName:"p"},"LogicException")," ?)"),Object(r.b)("p",null,"Une autre fa\xe7on est d'utiliser la fonction php ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.php.net/assert"}),Object(r.b)("inlineCode",{parentName:"a"},"assert"))," :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"assert(is_int($id));\n")),Object(r.b)("p",null,"C'est tr\xe8s simple, mais cela manque de description, et cela ne permet pas d'avoir d'assertions complexes \xe9crites simplement."),Object(r.b)("p",null,"On DEVRAIT utiliser la librairie webmozarts/assert qui donne acc\xe8s \xe0 un large panel d'assertion, et qui permet d'avoir un message d'erreur plus explicite."),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"Pour info, webmozarts utilise une ",Object(r.b)("inlineCode",{parentName:"p"},"InvalidArgumentException")," en soute."))),Object(r.b)("h2",{id:"if--match--switch"},"If / Match / Switch"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"If"),", ",Object(r.b)("inlineCode",{parentName:"p"},"match")," et ",Object(r.b)("inlineCode",{parentName:"p"},"switch")," sont trois fa\xe7ons diff\xe9rentes d'ex\xe9cuter du code conditionnel en PHP.\nLes trois fa\xe7ons sont valables, mais choisir l'une ou l'autre des instructions peut avoir un impact sur la lisibilit\xe9 du code."),Object(r.b)("p",null,"On DEVRAIT utiliser ",Object(r.b)("inlineCode",{parentName:"p"},"match"),' uniquement dans des cas "simples". Par exemple:'),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"$expressionResult = match ($condition) {\n    1, 2 => foo(),\n    3, 4 => bar(),\n    default => baz(),\n};\n\nmatch ($job->getName()) {\n    Job::NAME_EXPORT_DATA => $this->exportData($job),\n    Job::NAME_DENORMALIZE => $this->denormalize($job),\n    default => null,\n};\n")),Object(r.b)("p",null,"D\xe8s lors que l'on veut faire plusieurs choses dans un cas, on DEVRAIT utiliser un ",Object(r.b)("inlineCode",{parentName:"p"},"switch")," :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"switch ($action) {\n    case self::NAME_EXPORT_DATA:\n        $this->exportData($job);\n        break;\n    case self::DENORMALIZE:\n        $this->publishToRabbitMQ($job);\n        $this->onJobUpdated($job);\n        $this->triggerCoffeeMachine($job);\n        break;\n    default:\n        break;\n}\n")),Object(r.b)("p",null,"A noter quand dans ce cas, on PEUT aussi tout \xe0 refactorer le code du ",Object(r.b)("inlineCode",{parentName:"p"},"case self::DENORMALIZE")," dans une m\xe9thode d\xe9di\xe9e, et appeler ",Object(r.b)("inlineCode",{parentName:"p"},"match"),"."),Object(r.b)("p",null,"D\xe8s que les cas de tests deviennent trop complexes, on DEVRAIT utiliser un ",Object(r.b)("inlineCode",{parentName:"p"},"if")," / ",Object(r.b)("inlineCode",{parentName:"p"},"elseif")," / ",Object(r.b)("inlineCode",{parentName:"p"},"else")," :"),Object(r.b)("p",null,"Par exemple, on ne DEVRAIT pas faire \xe7a :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"$result = match ($x) {\n    foo() => 'value',\n    $this->bar() => 'value', // $this->bar() n'est pas appel\xe9 si foo() === $x\n    $this->baz => beep(), // beep() n'est pas appel\xe9 sauf si $x === $this->baz\n    // etc.\n};\n")),Object(r.b)("p",null,"Dans ce cas on DEVRAIT utiliser un ",Object(r.b)("inlineCode",{parentName:"p"},"if")," :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"if (foo()) {\n    $result = 'value';\n} elseif ($this->bar()) {\n    $result = 'value';\n} elseif ($this->baz) {\n    $result = beep();\n} else {\n    $result = null;\n}\n")),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(r.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(r.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(r.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(r.b)("p",{parentName:"div"},"On ne DEVRAIT jamais utiliser un ",Object(r.b)("inlineCode",{parentName:"p"},"match(true)")," ou un ",Object(r.b)("inlineCode",{parentName:"p"},"switch(true)")," et TOUJOURS utiliser des ",Object(r.b)("inlineCode",{parentName:"p"},"if")," dans ce cas."),Object(r.b)("p",{parentName:"div"},"Car le ",Object(r.b)("inlineCode",{parentName:"p"},"match(true)")," implique souvent que l'on va avoir des cas de tests trop complexes, sur des donn\xe9es diff\xe9rentes, et que l'on va perdre la lisibilit\xe9 du code."))),Object(r.b)("h2",{id:"utilisation-de-compact"},"Utilisation de ",Object(r.b)("inlineCode",{parentName:"h2"},"compact")),Object(r.b)("p",null,"Il existe une fonction ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.php.net/compact"}),Object(r.b)("inlineCode",{parentName:"a"},"compact"))," en PHP qui permet de cr\xe9er un tableau \xe0 partir de chaine de caract\xe8re:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-php"}),"$id  = 5;\n\n$r = compact('id');\n\n// [ 'id' => 5 ]\n")),Object(r.b)("p",null,'Cela dit, cette fonction est trop "magique" et moins lisible.'),Object(r.b)("p",null,"On NE DOIT PAS utiliser cette fonction en production, mais pr\xe9f\xe9rer la version explicite :"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"$id = 5;\n\n$r = ['id' => $id];\n")))}l.isMDXComponent=!0},161:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=i.a.createContext({}),l=function(e){var t=i.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},b=function(e){var t=l(e.components);return i.a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},u=Object(a.forwardRef)((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),b=l(n),u=a,m=b["".concat(s,".").concat(u)]||b[u]||d[u]||r;return n?i.a.createElement(m,c({ref:t},p,{components:n})):i.a.createElement(m,c({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,s=new Array(r);s[0]=u;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c.mdxType="string"==typeof e?e:a,s[1]=c;for(var p=2;p<r;p++)s[p]=n[p];return i.a.createElement.apply(null,s)}return i.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);